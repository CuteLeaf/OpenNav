<!DOCTYPE html>
<html lang="zh-CN" data-page-type="{% block page_type %}default{% endblock %}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />

    <!-- 棰勮渚ц竟鏍忕姸鎬侊紝閬垮厤鍒锋柊鎶栧姩 -->
    <script>
      (function () {
        var pageType =
          document.documentElement.getAttribute("data-page-type") || "default";
        var storageKey =
          "sidebarActive" + (pageType !== "default" ? "-" + pageType : "");
        var savedState = localStorage.getItem(storageKey);

        // 鍒嗙被椤甸潰榛樿鍏抽棴渚ц竟鏍忥紝闄ら潪鏄庣'淇濆瓨浜嗗紑鍚姸锟?
        if (pageType === "category") {
          if (savedState === "true") {
            document.documentElement.classList.add("sidebar-active-preload");
          }
        } else {
          // 鍏朵粬椤甸潰浣跨敤鍘熸潵鐨勯€昏緫
          if (
            savedState === "true" ||
            (savedState === null && window.innerWidth >= 768)
          ) {
            document.documentElement.classList.add("sidebar-active-preload");
          }
        }
      })();
    </script>
    <style>
      .sidebar-active-preload .sidebar {
        left: 0 !important;
        transition: none !important;
      }
      .sidebar-active-preload .main-content {
        padding-left: calc(var(--sidebar-width) + var(--spacing-lg)) !important;
        transition: none !important;
      }
    </style>

    {% if settings and settings.site_keywords %}
    <meta name="keywords" content="{{ settings.site_keywords }}" />
    {% endif %} {% if settings and settings.site_description %}
    <meta name="description" content="{{ settings.site_description }}" />
    {% endif %}

    <title>
      {% if title %}{{ title }} - {% endif %}{% if settings %}{{
      settings.site_name }}{% else %}鐐叿瀵艰埅{% endif %}
    </title>
    <!-- 寮曞叆瀛椾綋鍥炬爣-->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}"
    />
    <!-- 寮曞叆Font Awesome绮剧畝-->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='vendor/font-awesome/css/fontawesome.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='vendor/font-awesome/css/solid.min.css') }}"
    />
    <!-- 寮曞叆Bootstrap -->
    <link
      href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}"
      rel="stylesheet"
    />
    <!-- 寮曞叆鍔ㄧ敾-->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='vendor/animate.css/animate.min.css') }}"
    />
    <!-- 鑷畾涔塁SS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <!-- Tooltip CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/tooltip.css') }}"
    />
    <!-- 鍥炲埌椤堕儴CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/back-to-top.css') }}"
    />
    <!-- 椤佃剼CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/footer.css') }}"
    />
    <!-- Favicon -->
    {% if settings and settings.site_favicon %}
    <link
      rel="icon"
      href="{{ settings.site_favicon }}"
      type="image/{{ 'svg+xml' if settings.site_favicon.endswith('.svg') else 'x-icon' }}"
    />
    <link rel="shortcut icon" href="{{ settings.site_favicon }}" />
    <link rel="apple-touch-icon" href="{{ settings.site_favicon }}" />
    {% else %}
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
      type="image/x-icon"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
    />
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
    />
    {% endif %}
    <style>
      /* 淇CSS妫€鏌ュ櫒閿欒 */
      /* 娓呴櫎鎵€鏈夋棤鍏虫牱寮忛敊*/
      @media screen {
        .dummy-class {
          color: inherit;
        }
      }

      /* 鑷畾涔塀ootstrap tooltip鏍峰紡 */
      .tooltip .tooltip-inner {
        background: linear-gradient(
          135deg,
          rgba(112, 73, 240, 0.95),
          rgba(87, 50, 218, 0.98)
        );
        color: white;
        font-size: 14px;
        padding: 12px 18px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(112, 73, 240, 0.35);
        max-width: 300px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-weight: 300;
        line-height: 1.5;
        text-align: justify;
        text-justify: inter-word;
      }

      /* 涓婃柟绠ご棰滆壊 */
      .tooltip.bs-tooltip-bottom .tooltip-arrow::before {
        border-bottom-color: rgba(112, 73, 240, 0.95);
      }

      /* 涓嬫柟绠ご棰滆壊 */
      .tooltip.bs-tooltip-top .tooltip-arrow::before {
        border-top-color: rgba(87, 50, 218, 0.98);
      }

      /* 宸︿晶绠ご棰滆壊 */
      .tooltip.bs-tooltip-start .tooltip-arrow::before {
        border-left-color: rgba(112, 73, 240, 0.95);
      }

      /* 鍙充晶绠ご棰滆壊 */
      .tooltip.bs-tooltip-end .tooltip-arrow::before {
        border-right-color: rgba(112, 73, 240, 0.95);
      }

      /* 纭繚tooltip鏄剧ず */
      .tooltip {
        opacity: 1 !important;
        z-index: 9999 !important;
      }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body
    class="{% if current_user.is_authenticated and current_user.is_admin %}user-admin{% endif %} {% block body_class %}{% endblock %}"
  >
    <main>
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
        <div
          class="alert alert-{{ category }} alert-dismissible fade show animate__animated animate__fadeIn"
          role="alert"
        >
          {{ message }}
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %} {% block content %}{% endblock %}
    </main>

    {% block footer %} {# 寮曞叆妯″潡鍖栭〉#} {% with year = now.year %} {%
    include 'common/footer.html' %} {% endwith %} {% endblock %}

    <!-- JavaScript鑴氭湰 -->
    <script src="{{ url_for('static', filename='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendor/particles.js/particles.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/navbar.js') }}"></script>
    <!-- 鍥炲埌椤堕儴JS -->
    <script src="{{ url_for('static', filename='js/back-to-top.js') }}"></script>
    <!-- 椤甸潰搴曢儴閫氱敤JS -->
    <script>
      // 澶勭悊鍥炬爣鍔犺浇閿欒锛屾墍鏈夐〉闈㈤兘浼氭墽琛岃繖娈典唬锟?
      document.addEventListener("DOMContentLoaded", function () {
        // 涓烘墍鏈夌綉绔欏浘鏍囨坊鍔犻敊璇锟?
        function handleSiteImages() {
          const siteImages = document.querySelectorAll(
            ".site-icon img, .related-icon img"
          );
          siteImages.forEach((img) => {
            img.onerror = function () {
              const siteName = this.alt || "site";
              const firstLetter = siteName.charAt(0).toUpperCase();
              const parentEl = this.parentElement;

              // 绉婚櫎閿欒鐨勫浘锟?
              this.remove();

              // 鍒涘缓榛樿鍥炬爣
              const defaultIcon = document.createElement("div");
              defaultIcon.className = "default-site-icon";
              defaultIcon.textContent = firstLetter;
              parentEl.appendChild(defaultIcon);
            };

            // 妫€鏌ュ浘鐗囨槸鍚﹀凡缁忓姞杞藉苟涓旀槸鏈夋晥鍥炬爣
            if (img.complete) {
              validateImage(img);
            } else {
              img.onload = function () {
                validateImage(this);
              };
            }
          });
        }

        // 楠岃瘉鍥剧墖鏄惁鏈夋晥
        function validateImage(img) {
          if (img.naturalWidth === 0 || img.naturalHeight === 0) {
            img.onerror();
          }
        }

        // 鍒濆鍖栧浘鐗囧锟?
        handleSiteImages();

        // 鐩戝惉鍔ㄦ€佸姞杞界殑鍐呭
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (mutation.addedNodes.length) {
              handleSiteImages();
            }
          });
        });

        // 閰嶇疆瑙傚療锟?
        observer.observe(document.body, {
          childList: true,
          subtree: true,
        });
      });
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
